<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin - Qu·∫£n l√Ω Menu | Ph∆∞∆°ng Nhung Healthy Bites</title>
  <link rel="icon" href="images/favicon.png" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
  <style>
    .admin-header { padding: 18px 0; background: linear-gradient(90deg,var(--green-2),var(--green)); color: #fff; text-align:center; }
    .admin-header h2{margin:0;font-size:18px}
    .meta-small{font-size:13px;color:#666;margin-top:8px}
  </style>
</head>
<body>
  <header class="site-header">
    <div class="site-container">
      <a class="brand-link" href="index.html"><div class="brand-circle">PN</div><div class="brand-name">Ph∆∞∆°ng Nhung Healthy Bites<small>Qu·∫£n tr·ªã</small></div></a>
      <nav class="site-nav">
        <a class="nav-link" href="index.html">Trang ch·ªß</a>
        <a class="nav-link" href="menu.html">Th·ª±c ƒë∆°n</a>
        <a class="nav-link" href="about.html">Gi·ªõi thi·ªáu</a>
        <a class="nav-link active" href="contact.html">Li√™n h·ªá</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <div class="admin-header">
      <h2>Qu·∫£n l√Ω Menu h√¥m nay ‚Äî Tick m√≥n ƒë·ªÉ c·∫≠p nh·∫≠t cho kh√°ch</h2>
    </div>

    <div id="groupsContainer" class="container-card"></div>

    <div class="container-card">
      <h3>M√≥n ƒë√£ ch·ªçn h√¥m nay</h3>
      <ul id="selectedList"></ul>
      <p class="meta-small">T·ªïng: <span id="selectedCount">0</span> m√≥n</p>
      <button class="small-btn primary" id="btnSave">üíæ L∆∞u & C·∫≠p nh·∫≠t GitHub</button>
    </div>
  </main>

<script>
/* === CONFIG === */
const GITHUB_TOKEN = "PASTE_TOKEN_VAO_DAY"; 
const REPO = "taomenonline/phuongnhung-healthy-bites"; 
const FILE_PATH = "todayMenu.json";

/* === DATA MENU === */
const MENU_GROUPS = {
  "G√†": ["·ª®c g√† lu·ªôc","ƒê√πi g√† x√†o s·∫£ ·ªõt","G√† n∆∞·ªõng","G√† x√†o n·∫•m"],
  "C√°": ["C√° h·∫•p","C√° chi√™n","C√° thu s·ªët c√† chua"],
  "B√≤": ["B√≤ x√†o n·∫•m","B√≤ kho hoa qu·∫£"],
  "Rau": ["S√∫p l∆° lu·ªôc","C·∫£i ch√≠p lu·ªôc","MƒÉng x√†o","M∆∞·ªõp ƒë·∫Øng x√†o"],
  "C∆°m": ["C∆°m tr·∫Øng g·∫°o Nh·∫≠t","C∆°m l·ª©t t·ªïng h·ª£p"],
  "Kh√°c": ["Tr·ª©ng r√°n","ƒê·∫≠u s·ªët c√† chua","S∆∞·ªùn non chay"]
};

const groupsContainer = document.getElementById('groupsContainer');
const selectedListEl = document.getElementById('selectedList');
const selectedCountEl = document.getElementById('selectedCount');

function createGroupElements(){
  Object.entries(MENU_GROUPS).forEach(([groupName, items])=>{
    const box = document.createElement('div');
    box.className = 'group-box';
    const title = document.createElement('h3');
    title.textContent = `${groupName}`;
    box.appendChild(title);
    items.forEach(it=>{
      const lbl = document.createElement('label');
      lbl.className='item-label';
      const inp = document.createElement('input');
      inp.type='checkbox'; inp.value = it;
      inp.addEventListener('change', updateSelectedFromCheckboxes);
      lbl.appendChild(inp); lbl.appendChild(document.createTextNode(it));
      box.appendChild(lbl);
    });
    groupsContainer.appendChild(box);
  });
}
function updateSelectedFromCheckboxes(){
  const checked = Array.from(document.querySelectorAll('#groupsContainer input[type="checkbox"]:checked')).map(i=>i.value);
  renderSelectedList(checked);
}
function renderSelectedList(list){
  selectedListEl.innerHTML='';
  list.forEach((item,idx)=>{
    const li = document.createElement('li');
    li.textContent = `${idx+1}. ${item}`;
    selectedListEl.appendChild(li);
  });
  selectedCountEl.textContent = list.length;
}

/* === UPDATE TO GITHUB === */
async function updateMenuOnGitHub(selectedMenu) {
  try {
    let res = await fetch(`https://api.github.com/repos/${REPO}/contents/${FILE_PATH}`, {
      headers: { Authorization: `token ${GITHUB_TOKEN}` }
    });
    let data = await res.json();

    await fetch(`https://api.github.com/repos/${REPO}/contents/${FILE_PATH}`, {
      method: "PUT",
      headers: {
        Authorization: `token ${GITHUB_TOKEN}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        message: "C·∫≠p nh·∫≠t menu h√¥m nay",
        content: btoa(unescape(encodeURIComponent(JSON.stringify(selectedMenu, null, 2)))),
        sha: data.sha
      })
    });
    alert("‚úÖ Menu ƒë√£ c·∫≠p nh·∫≠t online!");
  } catch (e) {
    alert("‚ùå L·ªói c·∫≠p nh·∫≠t: " + e.message);
  }
}

document.getElementById('btnSave').addEventListener('click', ()=>{
  const checked = Array.from(document.querySelectorAll('#groupsContainer input[type="checkbox"]:checked')).map(i=>i.value);
  updateMenuOnGitHub(checked);
});

/* Init */
createGroupElements();
</script>
</body>
</html>
