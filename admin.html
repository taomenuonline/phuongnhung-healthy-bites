<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin - Quáº£n lÃ½ Menu | PhÆ°Æ¡ng Nhung Healthy Bites</title>
  <link rel="icon" href="images/favicon.png" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <!-- QR library -->
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
  <style>
    /* Small admin-specific overrides */
    .admin-header { padding: 18px 0; background: linear-gradient(90deg,var(--green-2),var(--green)); color: #fff; text-align:center; }
    .admin-header h2{margin:0;font-size:18px}
    .search-box{margin-bottom:12px}
    .selected-list ul{list-style:none;padding-left:0;margin:0}
    .selected-list li{padding:6px 8px;border-bottom:1px solid #f0f0f0}
    .meta-small{font-size:13px;color:#666;margin-top:8px}
  </style>
</head>
<body>
  <!-- header -->
  <header class="site-header">
    <div class="site-container">
      <a class="brand-link" href="index.html"><div class="brand-circle">PN</div><div class="brand-name">PhÆ°Æ¡ng Nhung Healthy Bites<small>Quáº£n trá»‹</small></div></a>
      <nav class="site-nav" aria-label="Main navigation">
        <a class="nav-link" href="index.html">Trang chá»§</a>
        <a class="nav-link" href="menu.html">Thá»±c Ä‘Æ¡n</a>
        <a class="nav-link" href="about.html">Giá»›i thiá»‡u</a>
        <a class="nav-link active" href="contact.html">LiÃªn há»‡</a>
      </nav>
      <div class="nav-actions">
        <a href="tel:0902032188" class="btn-cta">ğŸ“ Gá»i ngay</a>
        <button id="mobileToggle" class="mobile-toggle" aria-label="Má»Ÿ menu">â˜°</button>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="admin-header">
      <h2>Quáº£n lÃ½ Menu hÃ´m nay â€” Chá»n mÃ³n Ä‘á»ƒ cáº­p nháº­t cho trang khÃ¡ch</h2>
    </div>

    <div class="admin-wrap" style="margin-top:18px;">
      <div class="admin-left">
        <div class="group-box">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <strong>Danh má»¥c mÃ³n (má»Ÿ/Ä‘Ã³ng)</strong>
            <div class="meta-small">Nháº¥n tick Ä‘á»ƒ chá»n mÃ³n</div>
          </div>

          <!-- Groups will be injected here -->
          <div id="groupsContainer"></div>
        </div>
      </div>

      <div class="admin-right">
        <div class="group-box selected-list">
          <h3>MÃ³n Ä‘Ã£ chá»n hÃ´m nay</h3>
          <ul id="selectedList"></ul>
          <p class="meta-small">Tá»•ng: <span id="selectedCount">0</span> mÃ³n</p>

          <div class="row-actions" style="margin-top:10px">
            <button class="small-btn primary" id="btnSave">ğŸ’¾ LÆ°u & Táº¡o QR</button>
            <button class="small-btn outline" id="btnClear">ğŸ§¹ XÃ³a háº¿t</button>
          </div>

          <div class="qr-box" id="qrArea" style="margin-top:12px;display:none">
            <div id="qrcode"></div>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button class="small-btn primary" id="btnCopyLink">ğŸ“‹ Sao chÃ©p link</button>
              <button class="small-btn outline" id="btnShareFB">ğŸ”— Chia sáº» Fanpage</button>
              <button class="small-btn outline" id="btnShareZalo">ğŸ’¬ Má»Ÿ Zalo</button>
              <button class="small-btn outline" id="btnPreview">ğŸ‘€ Xem trÆ°á»›c</button>
            </div>
            <div class="meta-small" id="qrNote"></div>
          </div>

        </div>
      </div>
    </div>
  </main>

<script>
/* admin logic embedded - uses localStorage key 'todayMenu' */
/* first: protect admin page by checking login flag */
(function(){
  if(!localStorage.getItem('adminLogged')){
    window.location.href = 'login.html';
    return;
  }
})();

/* Menu data exactly as LÃ£o Gia cung cáº¥p (66 items, 10 groups) */
const MENU_GROUPS = {
  "GÃ ": [
    "á»¨c gÃ  luá»™c",
    "ÄÃ¹i gÃ  xÃ o sáº£ á»›t",
    "GÃ  nÆ°á»›ng (Ä‘Ã¹i + mÃ¡ Ä‘Ã¹i)",
    "GÃ  luá»™c (Ä‘Ã¹i + mÃ¡ Ä‘Ã¹i)",
    "á»¨c gÃ  xÃ o á»›t xanh Ä‘á»",
    "GÃ  xÃ o náº¥m",
    "GÃ  khÃ´ gá»«ng nghá»‡",
    "GÃ  xÃ o dá»©a",
    "á»¨c gÃ  quáº¥n lÃ¡ lá»‘t",
    "Má»c gÃ  náº¥m hÆ°Æ¡ng"
  ],
  "BÃ²": [
    "BÃ² xÃ o náº¥m Ä‘Ã¹i gÃ ",
    "BÃ² xÃ o náº¥m háº£i sáº£n",
    "BÃ² xÃ o hoa thiÃªn lÃ½",
    "BÃ² xÃ o giÃ¡",
    "BÃ² kho hoa quáº£",
    "BÃ² xÃ o náº¥m hÆ°Æ¡ng tÆ°Æ¡i"
  ],
  "TÃ´m": [
    "TÃ´m háº¥p",
    "TÃ´m rang ba chá»‰",
    "TÃ´m rim"
  ],
  "CÃ¡": [
    "CÃ¡ háº¥p",
    "CÃ¡ chiÃªn",
    "CÃ¡ nÆ°á»›ng",
    "CÃ¡ sÃ´ng chao giÃ²n",
    "CÃ¡ thu sá»‘t cÃ  chua",
    "CÃ¡ thu om tiÃªu",
    "CÃ¡ basa kho tiÃªu",
    "CÃ¡ kho dÆ°a"
  ],
  "Thá»‹t Lá»£n": [
    "Thá»‹t bÄƒm rang",
    "Thá»‹t ba chá»‰ rang tÃ´m",
    "Thá»‹t lá»£n kho dá»«a",
    "Thá»‹t lá»£n om máº¯c máº­t",
    "Thá»‹t lá»£n luá»™c",
    "Cháº£ sen",
    "Cháº£ lÃ¡ lá»‘t"
  ],
  "Rau": [
    "SÃºp lÆ¡ luá»™c",
    "BÃ­ xanh luá»™c",
    "Äá»— cÃ´ ve luá»™c",
    "Báº¯p cáº£i luá»™c",
    "CÃ  rá»‘t luá»™c",
    "Cá»§ dá»n luá»™c",
    "Xu hÃ o luá»™c",
    "Cáº£i chÃ­p luá»™c",
    "MÄƒng xÃ o",
    "Náº¥m Ä‘Ã¹i gÃ  om",
    "Náº¥m bao tá»­",
    "MÆ°á»›p Ä‘áº¯ng xÃ o",
    "Cá»§ cáº£i xÃ o",
    "MÆ°á»›p Ä‘áº¯ng xÃ o trá»©ng",
    "MÆ°á»›p hÆ°Æ¡ng luá»™c",
    "MÆ°á»›p hÆ°Æ¡ng xÃ o giÃ¡ Ä‘á»—"
  ],
  "Äáº­u": [
    "Äáº­u cÃ  chua",
    "Äáº­u táº©m hÃ nh",
    "Äáº­u sá»‘ng"
  ],
  "Trá»©ng": [
    "Trá»©ng luá»™c",
    "Trá»©ng rÃ¡n cuá»‘n rong biá»ƒn",
    "Trá»©ng rÃ¡n hÃ nh",
    "Trá»©ng rÃ¡n"
  ],
  "CÆ¡m": [
    "CÆ¡m tráº¯ng gáº¡o Nháº­t",
    "CÆ¡m lá»©t tá»•ng há»£p",
    "CÆ¡m lá»©t + háº¡t dinh dÆ°á»¡ng"
  ],
  "MÃ³n Chay": [
    "SÆ°á»n non chay",
    "GÃ  chay",
    "BÃ² chay",
    "Táº£o xoáº¯n",
    "Láº¡c rang",
    "Muá»‘i vá»«ng"
  ]
};

/* render groups */
const groupsContainer = document.getElementById('groupsContainer');
const selectedListEl = document.getElementById('selectedList');
const selectedCountEl = document.getElementById('selectedCount');

function createGroupElements(){
  Object.entries(MENU_GROUPS).forEach(([groupName, items])=>{
    const box = document.createElement('div');
    box.className = 'group-box';
    // toggler
    const header = document.createElement('div');
    header.style.display='flex';
    header.style.justifyContent='space-between';
    header.style.alignItems='center';
    const title = document.createElement('div');
    title.className='group-title';
    title.textContent = `${groupName} (${items.length})`;
    const btnToggle = document.createElement('button');
    btnToggle.className='small-btn outline';
    btnToggle.textContent = 'Má»Ÿ / ÄÃ³ng';
    btnToggle.style.fontSize='13px';
    header.appendChild(title);
    header.appendChild(btnToggle);
    box.appendChild(header);

    const list = document.createElement('div');
    list.style.marginTop='8px';
    items.forEach(it=>{
      const lbl = document.createElement('label');
      lbl.className='item-label';
      const inp = document.createElement('input');
      inp.type='checkbox';
      inp.value = it;
      inp.addEventListener('change', updateSelectedFromCheckboxes);
      const span = document.createElement('span');
      span.textContent = it;
      lbl.appendChild(inp);
      lbl.appendChild(span);
      list.appendChild(lbl);
    });
    btnToggle.addEventListener('click', ()=> {
      list.style.display = (list.style.display === 'none' || list.style.display === '') ? 'block' : 'none';
    });
    box.appendChild(list);
    groupsContainer.appendChild(box);
  });
}

function updateSelectedFromCheckboxes(){
  const checked = Array.from(document.querySelectorAll('#groupsContainer input[type="checkbox"]:checked')).map(i => i.value);
  renderSelectedList(checked);
}

function renderSelectedList(list){
  selectedListEl.innerHTML = '';
  list.forEach((item, idx)=>{
    const li = document.createElement('li');
    li.textContent = `${idx+1}. ${item}`;
    selectedListEl.appendChild(li);
  });
  selectedCountEl.textContent = list.length;
}

/* initialize checkboxes from saved todayMenu (if any) */
function syncCheckboxesWithSaved(){
  const saved = JSON.parse(localStorage.getItem('todayMenu')||'[]');
  if(saved.length === 0) return;
  const inputs = document.querySelectorAll('#groupsContainer input[type="checkbox"]');
  inputs.forEach(inp => {
    if(saved.includes(inp.value)) inp.checked = true;
    else inp.checked = false;
  });
  renderSelectedList(saved);
}

/* Save & create QR */
document.getElementById('btnSave').addEventListener('click', function(){
  const checked = Array.from(document.querySelectorAll('#groupsContainer input[type="checkbox"]:checked')).map(i => i.value);
  localStorage.setItem('todayMenu', JSON.stringify(checked));
  // show QR area
  showQRCodeForMenu(checked);
  alert('ÄÃ£ lÆ°u menu hÃ´m nay â€” ' + checked.length + ' mÃ³n.');
});

/* clear */
document.getElementById('btnClear').addEventListener('click', function(){
  if(!confirm('XÃ³a háº¿t cÃ¡c chá»n?')) return;
  const inputs = document.querySelectorAll('#groupsContainer input[type="checkbox"]');
  inputs.forEach(i => i.checked = false);
  selectedListEl.innerHTML = '';
  selectedCountEl.textContent = '0';
  localStorage.removeItem('todayMenu');
  document.getElementById('qrArea').style.display = 'none';
});

/* show QR for menu (QR links to menu.html) */
function showQRCodeForMenu(selected){
  const qrArea = document.getElementById('qrArea');
  qrArea.style.display = 'flex';
  qrArea.style.flexDirection = 'column';
  qrArea.style.alignItems = 'center';
  const box = document.getElementById('qrcode');
  box.innerHTML = '';
  // create shareable payload: link to menu.html (relative)
  const url = window.location.origin + window.location.pathname.replace(/\/admin.html$/,'') + '/menu.html';
  // For local file (when opened as file://) window.location.origin may be "null", so use relative
  const shareUrl = 'menu.html';
  new QRCode(box, { text: shareUrl, width: 140, height: 140 });
  document.getElementById('qrNote').textContent = `Menu hÃ´m nay (${(new Date()).toLocaleDateString()}) â€” quÃ©t QR Ä‘á»ƒ xem hoáº·c nháº¥n "Xem trÆ°á»›c".`;
}

/* copy link */
document.getElementById('btnCopyLink').addEventListener('click', function(){
  const shareUrl = window.location.href.replace(/admin\.html.*$/,'') + 'menu.html';
  navigator.clipboard && navigator.clipboard.writeText(shareUrl).then(()=> {
    alert('ÄÃ£ sao chÃ©p link menu: ' + shareUrl);
  }).catch(()=> {
    prompt('Sao chÃ©p link thá»§ cÃ´ng:', shareUrl);
  });
});

/* share to fanpage */
document.getElementById('btnShareFB').addEventListener('click', function(){
  // open fanpage share (link fixed per yÃªu cáº§u)
  const fan = 'https://facebook.com/phuongnhunghealthy';
  window.open(fan, '_blank');
});

/* open zalo chat */
document.getElementById('btnShareZalo').addEventListener('click', function(){
  // open zalo link (mobile will open app)
  window.open('https://zalo.me/0902032188', '_blank');
});

/* preview */
document.getElementById('btnPreview').addEventListener('click', function(){
  window.open('menu.html', '_blank');
});

/* on load */
createGroupElements();
syncCheckboxesWithSaved();
updateSelectedFromCheckboxes();
</script>
</body>
</html>
